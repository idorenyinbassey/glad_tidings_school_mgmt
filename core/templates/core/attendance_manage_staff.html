{% extends 'core/base.html' %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex align-items-center justify-content-between mt-3 mb-3">
    <h1 class="h4">Manage Staff Attendance</h1>
    <a href="{% url 'attendance' %}" class="btn btn-outline-secondary btn-sm">Back to Overview</a>
  </div>

  <div class="card mb-3 p-3">
    <form method="get" class="row g-2 align-items-end">
      <div class="col-md-6">
        <label class="form-label" for="q">Search staff (name, staff ID, department)</label>
        <input type="text" class="form-control" id="q" name="q" value="{{ q }}" placeholder="e.g. John, T-102, Science">
      </div>
      <div class="col-md-3">
        <label class="form-label" for="date">Date</label>
        <input type="date" class="form-control" id="date" name="date" value="{{ selected_date|date:'Y-m-d' }}">
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary">Search</button>
        <a href="{% url 'manage_staff_attendance' %}" class="btn btn-outline-secondary ms-2">Reset</a>
      </div>
    </form>
  </div>

  <form method="post" class="card">
    {% csrf_token %}
    <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}" />
    <div class="card-header d-flex align-items-center justify-content-between">
      <div>
        <strong>Results</strong>
        <small class="text-muted">showing up to 200</small>
      </div>
      <div>
        <button name="action" value="present" type="submit" class="btn btn-success btn-sm">Mark Present</button>
        <button name="action" value="absent" type="submit" class="btn btn-outline-danger btn-sm">Mark Absent</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr>
            <th style="width: 40px;"><input type="checkbox" id="checkAll" onclick="toggleAll(this)"></th>
            <th>Name</th>
            <th>Staff ID</th>
            <th>Department</th>
          </tr>
        </thead>
        <tbody>
          {% for s in staff_list %}
          <tr>
            <td><input type="checkbox" name="staff_ids" value="{{ s.id }}"></td>
            <td>{{ s.user.get_full_name }}</td>
            <td>{{ s.staff_id }}</td>
            <td>{{ s.get_department_display|default:s.department }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-center text-muted py-4">No staff found. Try a different search.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
</div>
<script>
function toggleAll(master){
  document.querySelectorAll('input[name="staff_ids"]').forEach(cb=>cb.checked = master.checked);
}
</script>
{% endblock %}
